<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Настройка хэшей</title><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="stylesheet" href="../../css/style_ru.css"></head><body><div id="banner"><div id="banner-content">

Celebrating <a href="https://github.com/nginx/nginx/commit/0e8348c50">20 years</a>
of nginx!
Read about our journey and milestones in the
<a href="https://blog.nginx.org/blog/celebrating-20-years-of-nginx">latest blog</a>.

</div></div><div id="main"><div id="menu"><input class="side-menu" type="checkbox" id="side-menu"><label class="hamb" for="side-menu"><span class="hamb-line"></span></label><nav class="nav"><h1><a href="/"><img src="/img/nginx_logo.png" alt="NGINX" class="lightimage" style="display: block; height: auto;"><div class="darkimageWrapper" style="mso-hide: all; display: none"><img src="/img/nginx_logo_dark.png" alt="NGINX" class="darkimage" style="display: none;"></div></a></h1><div><ul class="mobilemenu"><li><a href="../../en/docs/hash.html">english</a></li><li>русский<br></li><li><br></li><li><a href="../../news.html">новости</a> [en]</li><li><a href="../../ru/">об nginx</a></li><li><a href="../../ru/download.html">скачать</a></li><li><a href="../../en/security_advisories.html">безопасность</a> [en]</li><li><a href="./">документация</a></li><li><a href="faq.html">faq</a></li><li><a href="../../en/books.html">книги</a> [en]</li><li><a href="../../ru/community.html">сообщество</a></li><li><a href="../../ru/enterprise.html">компания</a></li><li><br></li><li><a href="https://x.com/nginxorg">x.com</a></li><li><a href="https://blog.nginx.org/">blog</a></li><li><br></li><li><a href="https://unit.nginx.org/">unit</a></li><li><a href="njs/">njs</a></li></ul></div></nav></div><div id="content"><h2>Настройка хэшей</h2><p>
Для быстрой обработки статических наборов данных, таких как имена серверов,
значения директивы <a href="http/ngx_http_map_module.html#map">map</a>,
MIME-типы, имена полей заголовков запросов,
nginx использует хэш-таблицы.
Во время старта и при каждой переконфигурации nginx подбирает минимально
возможный размер хэш-таблиц с учётом того, чтобы размер корзины,
куда попадают ключи с совпадающими хэш-значениями,
не превышал заданного параметра (hash bucket size).
Размер таблицы считается в корзинах.
Подбор ведётся до тех пор, пока размер таблицы не превысит параметр
hash max size.
Для большинства хэшей есть директивы, которые позволяют менять эти параметры,
например, для хэшей имён серверов директивы называются
<a href="http/ngx_http_core_module.html#server_names_hash_max_size">server_names_hash_max_size</a>
и <a href="http/ngx_http_core_module.html#server_names_hash_bucket_size">server_names_hash_bucket_size</a>.
</p><p>
Параметр hash bucket size всегда выравнивается до размера, кратного
размеру строки кэша процессора. Это позволяет ускорить поиск ключа
в хэше на современных процессорах, уменьшив число обращений к памяти.
Если hash bucket size равен размеру одной строки кэша процессора,
то во время поиска ключа число обращений к памяти в худшем случае
будет равно двум — первый раз для определения адреса корзины,
а второй — при поиске ключа внутри корзины.
Соответственно, если nginx выдал сообщение о необходимости увеличить
hash max size или hash bucket size, то сначала нужно увеличивать первый
параметр.
</p></div></div></body></html>
